<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penguin Fitness</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
        .exercise-form {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Text space for workout first -->
        <div class="row">
            <div class="col-sm-6">
                <form class="workout-form">
                    <div class="form-group">
                        <label>Workout:</label>
                        <input type="text" id="workout_name" name="Workout">
                    </div>
                    <button class="button" type="submit">Submit</button>
                </form>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <div class="workoutArea">

                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <form class="exercise-form">
                    <div class="form-group">
                        <label>Exercise Name:</label>
                        <input type="text" id="exercise_name" name="Exercise">
                    </div>
                    <div class="form-group">
                        <label>Number of Reps:</label>
                        <input type="number" id="num_reps" name="Number of Reps">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <input type="text" id="exercise_desc" name="Exercise Description">
                    </div>
                    <button class="button" type="submit">Submit</button>
                </form>
            </div>
            <br>
            <p>
                Exercise List:
            </p>
            <div class="exerciseList">

            </div>
            <br>
        </div>
    </div>
</body>
<script>
    let workoutName = "";
    let workoutID = "";
    // Expect to pass objects and to retrieve objects here
    $(".workout-form").on("submit", function (event) {
        event.preventDefault();
        console.log("Worked")
        var workout = $("#workout_name").val().trim();
        console.log(workout);
        var workoutObj = { name: workout };
        console.log(workoutObj);
        $.post("/api/workout", workoutObj).then(function (res) {
            console.log(res);
        })
    })

    let workoutList = function () {
        $.ajax({
            url: "/workout",
            method: "GET"
        }).then(function (response) {
            console.log(response);
            for (let index = 0; index < response.length; index++) {
                const element = response[index];
                console.log(element.name)
                //create button that has name as label, element._id as data-attr, and is attached to workoutArea div
                var workoutButton = $("<button>");
                workoutButton.addClass("workoutButton");
                workoutButton.text(element.name);
                workoutButton.data("attr", element._id);
                workoutButton.attr("id", element._id);
                workoutButton.data("name", element.name);
                $(".workoutArea").append(workoutButton)
                $(".workoutArea").append($("<br>"))
                console.log(workoutButton.data())
            }
        })
    }

    //click event that opens up a modal when a workoutButton w/class of workoutButton is clicked. lets user define an exercise in the modal that forces them to give a name, and optionally # of reps and description. once submitted, modal closes, makes a post request to /api/workout/:id using the data-attr of the clicked button as the id, and exercise list is populated with that exercise. if user wants to add another exercise, they need to go through modal again.
    $(document).on("click", ".workoutButton", function (event) {
        event.preventDefault();
        console.log("Workout Button clicked");
        console.log("this.data: ", $(this).data());
        let workoutID = $(this).data().attr;
        let workoutName = $(this).data().name;
        exerciseList(workoutID);
        console.log("workoutID: ", workoutID);
        console.log("workoutName: ", workoutName)
        //after this, reveal the middle column with the exercise stuff; need this in here so the workoutID and name are not forgotten so the post route happens to the proper workout!!!
        $(".exercise-form").show();
        $(".exercise-form").on("submit", function (event) {
            event.preventDefault();
            console.log("Worked")
            var exerciseName = $("#exercise_name").val().trim();
            console.log("exerciseName: ", exerciseName);
            var num_reps = $("#num_reps").val();
            var exercise_desc = $("#exercise_desc").val().trim();
            console.log("num_reps: ", num_reps)
            console.log("exercise_decs: ", exercise_desc)
            var exerciseObj = {
                name: exerciseName,
                reps: num_reps,
                description: exercise_desc
            };
            console.log("exerciseObj: ", exerciseObj);
            console.log("workoutName: ", workoutName)
            console.log("workoutID: ", workoutID)
            let ajaxURL = "/api/workout/" + workoutID;
            //just post to /api/workout/:id, and then make/call a new function 
            $.post(ajaxURL, exerciseObj).then(function (res) {
                console.log(res);
                //want to call exerciseList with the name of the workout here so that it starts getting populated
                exerciseList(res._id);
            })
        })
    })

    let exerciseList = function(workoutID) {
        console.log("Write the exercise list function to make a get route to /workout/:id using the workoutID parameter");
        console.log("exerciseList workoutID: ", workoutID);
        let ajaxURL = "/workout/" + workoutID;
        console.log("ajaxURL: ", ajaxURL)
        $.ajax({
            url: ajaxURL,
            method: "GET"
        }).then(function (response) {
            for (let index = 0; index < response.length; index++) {
                const workout = response[index].exercises;
                for (let i = 0; i < workout.length; i++) {
                    const exercise = workout[i];
                    console.log("Exercise: ", exercise)
                    var exerciseText = $("<p>");
                    $(".exerciseList").append($("<br>"))
                    exerciseText.text(`Name: ${exercise.name} Reps: ${exercise.reps} Description: ${exercise.description}`);
                    $(".exerciseList").append(exerciseText)
                }
            }
        })
    }

    workoutList();
</script>

</html>